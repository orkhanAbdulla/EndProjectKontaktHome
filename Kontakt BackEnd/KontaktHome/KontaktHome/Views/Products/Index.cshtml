@model CategoryProductVM
@{
    ViewData["Title"] = "Index";
}
<section id="product-search">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                @if (ViewBag.Id != null)
                {
                    <h1 class="page-header">@Model.Category.Name</h1>
                    <div class="page-text">
                        @Html.Raw(Model.Category.Title);
                    </div>
                }
                else
                {
                    <h1 class="page-header">@Model.Brand.Name</h1>
                    <div class="page-text">
                        @Html.Raw(Model.Brand.Title);
                    </div>
                }

                <p style="text-align:right" class="dahacoxgoster ">
                    <a href="#" class="a-collapse" data-toggle="collapse">
                        <span class="coxspan coxazspan">daha çox göstər</span>
                        <span class="azspan coxazspan d-none">daha az göstər</span>
                        <i class="fa fa-chevron-down "></i>
                        <i class="fa fa-chevron-up d-none"></i>
                    </a>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-3">
                <div id="search-menu">
                    <div class="menu">
                        <form >
                            <ul class="first-menu">
                                <li class="active">
                                    <div class="title">
                                        <p style="width:100%;">@Model.Category.Name</p>
                                        <div class="icon">
                                            <svg enable-background="new 0 0 240.823 240.823" version="1.1"
                                                 viewBox="0 0 240.823 240.823" xml:space="preserve"
                                                 xmlns="http://www.w3.org/2000/svg">
                                            <path d="m57.633 129.01l108.3 108.26c4.752 4.74 12.451 4.74 17.215 0 4.752-4.74 4.752-12.439 0-17.179l-99.707-99.671 99.695-99.671c4.752-4.74 4.752-12.439 0-17.191-4.752-4.74-12.463-4.74-17.215 0l-108.3 108.26c-4.679 4.691-4.679 12.511 0.012 17.191z">
                                                        </path>
                                                    </svg>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                            <button type="button" class="btn-feature active">
                                <div class="icon">
                                    <svg enable-background="new 0 0 240.823 240.823" version="1.1"
                                         viewBox="0 0 240.823 240.823" xml:space="preserve"
                                         xmlns="http://www.w3.org/2000/svg">
                                    <path d="m57.633 129.01l108.3 108.26c4.752 4.74 12.451 4.74 17.215 0 4.752-4.74 4.752-12.439 0-17.179l-99.707-99.671 99.695-99.671c4.752-4.74 4.752-12.439 0-17.191-4.752-4.74-12.463-4.74-17.215 0l-108.3 108.26c-4.679 4.691-4.679 12.511 0.012 17.191z">
                                                </path>
                                            </svg>
                                </div>
                                Qiymət
                                <a data-toggle="tooltip" data-placement="right" class="tooltip-info"
                                   data-html="true" title="" data-original-title="">
                                    <img src="https://kontakt.az/wp-content/themes/kontakt7/ktn-assets/assets/info.png"
                                         alt="">
                                </a>
                            </button>
                            <div class="price-range sub-menu">
                                <div class="form-row">
                                    <div class="col price-from">
                                        <input type="number" class="form-control" id="from" name="fqn">
                                    </div>
                                    <div class="col">
                                        <input type="number" class="form-control" id="to" name="fqx">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <a id="buttonFilter" class="btn btn-action btn-submit">Axtar</a>
                                <input id="cateId" hidden value="@ViewBag.Id" />
                                <input id="brandId" hidden value="@ViewBag.BrandId" />
                            </div>

                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div id="product-list">
                    <div class="product-list-header">
                        <div class="list-view-by list-view-by-cat">
                            @if (ViewBag.Id != null)
                            {
                                <h4>@Model.Category.Name</h4>
                            }
                            else
                            {
                                <h4>@Model.Brand.Name</h4>
                            }
                            <ul class="list-view">
                                <li class="click-view">
                                    <a href="#">
                                        Ada görə (A-Z)
                                        <svg class="sgvup" enable-background="new 0 0 240.823 240.823" version="1.1" viewBox="0 0 240.823 240.823" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
                                        <path d="m57.633 129.01l108.3 108.26c4.752 4.74 12.451 4.74 17.215 0 4.752-4.74 4.752-12.439 0-17.179l-99.707-99.671 99.695-99.671c4.752-4.74 4.752-12.439 0-17.191-4.752-4.74-12.463-4.74-17.215 0l-108.3 108.26c-4.679 4.691-4.679 12.511 0.012 17.191z"></path>
                                    </svg>
                                    </a>
                                </li>
                                <li class="click-view">
                                    <a href="#">
                                        Bahadan-ucuza
                                        <svg class="" enable-background="new 0 0 240.823 240.823" version="1.1" viewBox="0 0 240.823 240.823" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
                                        <path d="m57.633 129.01l108.3 108.26c4.752 4.74 12.451 4.74 17.215 0 4.752-4.74 4.752-12.439 0-17.179l-99.707-99.671 99.695-99.671c4.752-4.74 4.752-12.439 0-17.191-4.752-4.74-12.463-4.74-17.215 0l-108.3 108.26c-4.679 4.691-4.679 12.511 0.012 17.191z"></path>
                                    </svg>
                                    </a>
                                </li>
                                <li class="click-view">
                                    <a href="#">
                                        Yeni məhsul
                                        <svg class="" enable-background="new 0 0 240.823 240.823" version="1.1" viewBox="0 0 240.823 240.823" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
                                        <path d="m57.633 129.01l108.3 108.26c4.752 4.74 12.451 4.74 17.215 0 4.752-4.74 4.752-12.439 0-17.179l-99.707-99.671 99.695-99.671c4.752-4.74 4.752-12.439 0-17.191-4.752-4.74-12.463-4.74-17.215 0l-108.3 108.26c-4.679 4.691-4.679 12.511 0.012 17.191z"></path>
                                    </svg>
                                    </a>
                                </li>
                                <li>
                                    <ul class="click-num">
                                        <li>
                                            <img src="https://kontakt.az/wp-content/themes/kontakt7/ktn-assets/assets/view.png" alt="">
                                        </li>
                                        <li>
                                            <a href="#" class="view-no active">16</a>
                                        </li>
                                        <li>
                                            <a href="#" class="view-no ">48</a>
                                        </li>
                                        <li>
                                            <a href="#" class="view-no ">72</a>
                                        </li>
                                        <li>
                                            <a href="#" class="view-no ">96</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="product-list-items">
                        @foreach (Product pro in Model.Products)
                        {
                            <div class="item">
                                <div class="cart-item xustekcart">
                                    <div class="cart-body-top">
                                        <div class="imgHolder">
                                            <a asp-controller="Products" asp-action="Detail" asp-route-Id="@pro.Id">
                                                <img data-qazy="true"
                                                     alt="Samsung Galaxy S21 DUAL (SM-G991B) Gray"
                                                     src="~/img/products/@pro.Images[0].Image">
                                            </a>
                                            <div class="lbl-cash-discount lbl-120-per lbl-percentage-grid-2021-360">
                                                <img src="https://kontakt.az/wp-content/uploads/2021/03/4_az.png">
                                            </div>
                                            @if (pro.Discount > 0)
                                            {
                                                <div class="lbl-percentage lbl-percentage-grid lbl-percentage-grid-2021-xususi">
                                                    <p>Xüsusi təklif</p>
                                                </div>
                                            }

                                        </div>
                                        <div class="name">
                                            <a draggable="false"
                                               href="https://kontakt.az/samsung-galaxy-s21-dual-sm-g991b-gray/">
                                                @pro.Name
                                            </a>
                                            <div class="lbl-2021 scale" style="background-color:#e3e3e3">
                                                <p style="color: #000 !important; font-weight: 700 !important">0<small class="azn_span">₼</small>.0%.18ay</p>
                                            </div>
                                        </div>
                                        <div class="cart-footer">
                                            @if (pro.Discount > 0)
                                            {
                                                <p class="endirimvar" style="font-size: 16px; color: #ff003c">
                                                    <span style="text-decoration:line-through;font-weight:normal; color: #282828; text-decoration-color: #ff003c !important">@(pro.Price + ((pro.Price * pro.Discount) / 100))<small class="azn_span">₼</small></span>
                                                    <br>
                                                    <span class="nprice" id="price-869329">@(pro.Price)<small class="azn_span">₼</small></span>
                                                </p>
                                            }
                                            else
                                            {
                                                <p>
                                                    <span class="nprice" id="price-692028">@pro.Price</span> <small class=" ‎azn_span">₼</small>
                                                </p>
                                            }
                                            <button class="btn-add-to-cart" id="AddBasket">Səbətə at</button>
                                            <input type="hidden" id="ProductId" value="@pro.Id" />
                                        </div>
                                    </div>
                                    <div class="cart-add">
                                        <ul>

                                            <li>
                                                <p>Ekran</p> <span> 6.2" </span>
                                            </li>
                                            <li>
                                                <p>Batareya</p> <span> 4000 (mAh) </span>
                                            </li>
                                            <li>
                                                <p>Zəmanət</p> <span> 1 il </span>
                                            </li>
                                            <li>
                                                <p>Zəmanət</p> <span> 1 il </span>
                                            </li>
                                            <li>
                                                <p>Zəmanət</p> <span> 1 il </span>
                                            </li>
                                        </ul>
                                        <div class="action">
                                            <button type="button" class="compare-button" data-id="692028"
                                                    data-mid="00627244" data-price="2099.99">
                                                <div class="icon">
                                                    <img src="https://kontakt.az/wp-content/themes/kontakt7/ktn-assets/assets/tb-comparisonnew.png">
                                                    <img class="active"
                                                         src="https://kontakt.az/wp-content/themes/kontakt7/ktn-assets/assets/comparisonnew.png">

                                                </div>
                                                <span>Müqayisə et</span>
                                            </button>
                                            <button type="button" class="select-item" data-id="692028"
                                                    data-mid="00627244" data-price="2099.99">
                                                <div class="icon">
                                                    <i class="fa fa-heart-o" aria-hidden="true"></i>
                                                </div>
                                                <span>Seçilmiş et</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }

                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
@section Script{
    <script>

        $(document).ready(function () {
            $(document).on("click", "#AddBasket", function () {
                var productId = $(this).next().val();
                alertify.set('notifier', 'delay', 1);
                alertify.set('notifier', 'position', 'bottom-center');
                alertify.error('İcra edildi!');
                $.ajax({
                    url: "/Products/AddBasket?id=" + productId,
                    type: "Get",
                    success: function (res) {
                        $(".cart_count").empty();
                        $(".cart_count").append(res);
                    }
                });
            });

            $(document).on("click", "#buttonFilter", function () {
                let from = $("#from").val()
                let to = $("#to").val()
                console.log("1")

                if ($("#cateId").val()!== "") {
                    $.ajax({
                        url: "/Products/Filter/",
                        type: "Get",
                        data: {
                            "categoryId": $("#cateId").val(),
                            "from": from,
                            "to":to,
                        },
                        success: function (res) {
                            console.log("2")
                            console.log("dsas")
                            $(".product-list-items").empty();
                            $(".product-list-items").append(res);
                        }
                    })
                }
                if ($("#brandId").val() !== "") {
                    $.ajax({
                        url: "/Products/Filter/",
                        type: "Get",
                        data: {
                            "brandId": $("#brandId").val(),
                            "from": from,
                            "to":to,
                        },
                        success: function (res) {
                            console.log("2")

                            $(".product-list-items").empty();
                            $(".product-list-items").append(res);
                        }
                    })
                }


            });
        })




    </script>
}




